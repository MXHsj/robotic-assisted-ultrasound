%% read data
clc; clear; close all;

dir1 = 'data/reg1_validate.csv';
dir2 = 'data/reg2_validate.csv';
dir3 = 'data/reg3_validate.csv';
dir4 = 'data/reg4_validate.csv';
dir5 = 'data/reg5_validate.csv';
dir6 = 'data/reg6_validate.csv';
dir7 = 'data/reg7_validate.csv';
dir8 = 'data/reg8_validate.csv';
dir9 = 'data/reg9_validate.csv';
dir10 = 'data/reg10_validate.csv';
dir11 = 'data/reg11_validate.csv';
dir12 = 'data/reg12_validate.csv';

data1_raw = csvread(dir1);
data1 = removeBadData(data1_raw);
data2_raw = csvread(dir2);
data2 = removeBadData(data2_raw);
data3_raw = csvread(dir3);
data3 = removeBadData(data3_raw);
data4_raw = csvread(dir4);
data4 = removeBadData(data4_raw);
data5_raw = csvread(dir5);
data5 = removeBadData(data5_raw);
data6_raw = csvread(dir6);
data6 = removeBadData(data6_raw);
data7_raw = csvread(dir7);
data7 = removeBadData(data7_raw);
data8_raw = csvread(dir8);
data8 = removeBadData(data8_raw);
data9_raw = csvread(dir9);
data9 = removeBadData(data9_raw);
data10_raw = csvread(dir10);
data10 = removeBadData(data10_raw);
data11_raw = csvread(dir11);
data11 = removeBadData(data11_raw);
data12_raw = csvread(dir12);
data12 = removeBadData(data12_raw);

%% plot error bar chart
% rotation
est_vec1 = [data1(1:3:end-2,10),data1(2:3:end-1,10),data1(3:3:end,10)];
gt_vec1 = [data1(1:3:end-2,11),data1(2:3:end-1,11),data1(3:3:end,11)];
rot_err1 = 1.0004 - dot(est_vec1, gt_vec1, 2);

est_vec2 = [data2(1:3:end-2,10),data2(2:3:end-1,10),data2(3:3:end,10)];
gt_vec2 = [data2(1:3:end-2,11),data2(2:3:end-1,11),data2(3:3:end,11)];
rot_err2 = 1.0004 - dot(est_vec2, gt_vec2, 2);

est_vec3 = [data3(1:3:end-2,10),data3(2:3:end-1,10),data3(3:3:end,10)];
gt_vec3 = [data3(1:3:end-2,11),data3(2:3:end-1,11),data3(3:3:end,11)];
rot_err3 = 1.0004 - dot(est_vec3, gt_vec3, 2);

est_vec4 = [data4(1:3:end-2,10),data4(2:3:end-1,10),data4(3:3:end,10)];
gt_vec4 = [data4(1:3:end-2,11),data4(2:3:end-1,11),data4(3:3:end,11)];
rot_err4 = 1.0004 - dot(est_vec4, gt_vec4, 2);

est_vec5 = [data5(1:3:end-2,10),data5(2:3:end-1,10),data5(3:3:end,10)];
gt_vec5 = [data5(1:3:end-2,11),data5(2:3:end-1,11),data5(3:3:end,11)];
rot_err5 = 1.0004 - dot(est_vec5, gt_vec5, 2);

est_vec6 = [data6(1:3:end-2,10),data6(2:3:end-1,10),data6(3:3:end,10)];
gt_vec6 = [data6(1:3:end-2,11),data6(2:3:end-1,11),data6(3:3:end,11)];
rot_err6 = 1.0004 - dot(est_vec6, gt_vec6, 2);

est_vec7 = [data7(1:3:end-2,10),data7(2:3:end-1,10),data7(3:3:end,10)];
gt_vec7 = [data7(1:3:end-2,11),data7(2:3:end-1,11),data7(3:3:end,11)];
rot_err7 = 1.0004 - dot(est_vec7, gt_vec7, 2);

est_vec8 = [data8(1:3:end-2,10),data8(2:3:end-1,10),data8(3:3:end,10)];
gt_vec8 = [data8(1:3:end-2,11),data8(2:3:end-1,11),data8(3:3:end,11)];
rot_err8 = 1.0004 - dot(est_vec8, gt_vec8, 2);

est_vec9 = [data9(1:3:end-2,10),data9(2:3:end-1,10),data9(3:3:end,10)];
gt_vec9 = [data9(1:3:end-2,11),data9(2:3:end-1,11),data9(3:3:end,11)];
rot_err9 = 1.0004 - dot(est_vec9, gt_vec9, 2);

est_vec10 = [data10(1:3:end-2,10),data10(2:3:end-1,10),data10(3:3:end,10)];
gt_vec10 = [data10(1:3:end-2,11),data10(2:3:end-1,11),data10(3:3:end,11)];
rot_err10 = 1.0004 - dot(est_vec10, gt_vec10, 2);

est_vec11 = [data11(1:3:end-2,10),data11(2:3:end-1,10),data11(3:3:end,10)];
gt_vec11 = [data11(1:3:end-2,11),data11(2:3:end-1,11),data11(3:3:end,11)];
rot_err11 = 1.0004 - dot(est_vec11, gt_vec11, 2);

est_vec12 = [data12(1:3:end-2,10),data12(2:3:end-1,10),data12(3:3:end,10)];
gt_vec12 = [data12(1:3:end-2,11),data12(2:3:end-1,11),data12(3:3:end,11)];
rot_err12 = 1.0004 - dot(est_vec12, gt_vec12, 2);

rot_errs = [rot_err1,rot_err2,rot_err3,rot_err4,rot_err5,rot_err6, ...
            rot_err7,rot_err8,rot_err9,rot_err10,rot_err11,rot_err12];

rot_x_err = [est_vec1(:,1) - gt_vec1(:,1), ...
             est_vec2(:,1) - gt_vec2(:,1), ...
             est_vec3(:,1) - gt_vec3(:,1), ...
             est_vec4(:,1) - gt_vec4(:,1), ...
             est_vec5(:,1) - gt_vec5(:,1) ...
             est_vec6(:,1) - gt_vec6(:,1), ... 
             est_vec7(:,1) - gt_vec7(:,1), ...
             est_vec8(:,1) - gt_vec8(:,1), ...
             est_vec9(:,1) - gt_vec9(:,1), ...
             est_vec10(:,1) - gt_vec10(:,1), ...
             est_vec11(:,1) - gt_vec11(:,1), ...
             est_vec12(:,1) - gt_vec12(:,1)];
         
rot_y_err = [est_vec1(:,2) - gt_vec1(:,2), ...
             est_vec2(:,2) - gt_vec2(:,2), ...
             est_vec3(:,2) - gt_vec3(:,2), ...
             est_vec4(:,2) - gt_vec4(:,2), ...
             est_vec5(:,2) - gt_vec5(:,2) ...
             est_vec6(:,2) - gt_vec6(:,2), ... 
             est_vec7(:,2) - gt_vec7(:,2), ...
             est_vec8(:,2) - gt_vec8(:,2), ...
             est_vec9(:,2) - gt_vec9(:,2), ...
             est_vec10(:,2) - gt_vec10(:,2), ...
             est_vec11(:,2) - gt_vec11(:,2), ...
             est_vec12(:,2) - gt_vec12(:,2)]; 
         
rot_z_err = [est_vec1(:,3) - gt_vec1(:,3), ...
             est_vec2(:,3) - gt_vec2(:,3), ...
             est_vec3(:,3) - gt_vec3(:,3), ...
             est_vec4(:,3) - gt_vec4(:,3), ...
             est_vec5(:,3) - gt_vec5(:,3) ...
             est_vec6(:,3) - gt_vec6(:,3), ... 
             est_vec7(:,3) - gt_vec7(:,3), ...
             est_vec8(:,3) - gt_vec8(:,3), ...
             est_vec9(:,3) - gt_vec9(:,3), ...
             est_vec10(:,3) - gt_vec10(:,3), ...
             est_vec11(:,3) - gt_vec11(:,3), ...
             est_vec12(:,3) - gt_vec12(:,3)];         
         
subplot(2,2,1)
bar(1:12, mean(rot_errs));
xlabel('region ID')
ylabel({'mean rotation error','normalized to [0,1]'})
hold on
errorbar(1:1:12, mean(rot_errs), std(rot_errs))
set(gca, 'YGrid', 'on', 'XGrid', 'off')

subplot(2,2,2)
bar(1:12, [mean(rot_x_err);mean(rot_y_err);mean(rot_z_err)], 'stacked')
xlabel('region ID')
ylabel({'decomposed rotation error','normalized to [-1,1]'})
ylim([-0.5,1.0])
set(gca, 'YGrid', 'on', 'XGrid', 'off')
legend('x component', 'y component', 'z component')

% translation
trans_err1 = sqrt((data1(1:3:end-2,12)-data1(1:3:end-2,1)).^2+ ...
                  (data1(2:3:end-1,12)-data1(2:3:end-1,1)).^2+ ...
                  (data1(3:3:end,12)-data1(3:3:end,1)).^2).*1000;

trans_err2 = sqrt((data2(1:3:end-2,12)-data2(1:3:end-2,1)).^2+ ...
                  (data2(2:3:end-1,12)-data2(2:3:end-1,1)).^2+ ...
                  (data2(3:3:end,12)-data2(3:3:end,1)).^2).*1000;
              
trans_err3 = sqrt((data3(1:3:end-2,12)-data3(1:3:end-2,1)).^2+ ...
                  (data3(2:3:end-1,12)-data3(2:3:end-1,1)).^2+ ...
                  (data3(3:3:end,12)-data3(3:3:end,1)).^2).*1000;
              
trans_err4 = sqrt((data4(1:3:end-2,12)-data4(1:3:end-2,1)).^2+ ...
                  (data4(2:3:end-1,12)-data4(2:3:end-1,1)).^2+ ...
                  (data4(3:3:end,12)-data4(3:3:end,1)).^2).*1000;
              
trans_err5 = sqrt((data5(1:3:end-2,12)-data5(1:3:end-2,1)).^2+ ...
                  (data5(2:3:end-1,12)-data5(2:3:end-1,1)).^2+ ...
                  (data5(3:3:end,12)-data5(3:3:end,1)).^2).*1000;
              
trans_err6 = sqrt((data6(1:3:end-2,12)-data6(1:3:end-2,1)).^2+ ...
                  (data6(2:3:end-1,12)-data6(2:3:end-1,1)).^2+ ...
                  (data6(3:3:end,12)-data6(3:3:end,1)).^2).*1000;
              
trans_err7 = sqrt((data7(1:3:end-2,12)-data7(1:3:end-2,1)).^2+ ...
                  (data7(2:3:end-1,12)-data7(2:3:end-1,1)).^2+ ...
                  (data7(3:3:end,12)-data7(3:3:end,1)).^2).*1000;
              
trans_err8 = sqrt((data8(1:3:end-2,12)-data8(1:3:end-2,1)).^2+ ...
                  (data8(2:3:end-1,12)-data8(2:3:end-1,1)).^2+ ...
                  (data8(3:3:end,12)-data8(3:3:end,1)).^2).*1000;
              
trans_err9 = sqrt((data9(1:3:end-2,12)-data9(1:3:end-2,1)).^2+ ...
                  (data9(2:3:end-1,12)-data9(2:3:end-1,1)).^2+ ...
                  (data9(3:3:end,12)-data9(3:3:end,1)).^2).*1000;
              
trans_err10 = sqrt((data10(1:3:end-2,12)-data10(1:3:end-2,1)).^2+ ...
                  (data10(2:3:end-1,12)-data10(2:3:end-1,1)).^2+ ...
                  (data10(3:3:end,12)-data10(3:3:end,1)).^2).*1000;
              
trans_err11 = sqrt((data11(1:3:end-2,12)-data11(1:3:end-2,1)).^2+ ...
                  (data11(2:3:end-1,12)-data11(2:3:end-1,1)).^2+ ...
                  (data11(3:3:end,12)-data11(3:3:end,1)).^2).*1000;              

              
trans_err12 = sqrt((data12(1:3:end-2,12)-data12(1:3:end-2,1)).^2+ ...
                  (data12(2:3:end-1,12)-data12(2:3:end-1,1)).^2+ ...
                  (data12(3:3:end,12)-data12(3:3:end,1)).^2).*1000; 
              
trans_errs = [trans_err1,trans_err2,trans_err3,trans_err4, ...
              trans_err5,trans_err6,trans_err7,trans_err8, ...
              trans_err9,trans_err10,trans_err11,trans_err12];  

trans_x_err = [data1(1:3:end-2,12)-data1(1:3:end-2,1), ...
               data2(1:3:end-2,12)-data2(1:3:end-2,1), ...
               data3(1:3:end-2,12)-data3(1:3:end-2,1), ...
               data4(1:3:end-2,12)-data4(1:3:end-2,1), ...
               data5(1:3:end-2,12)-data5(1:3:end-2,1), ...
               data6(1:3:end-2,12)-data6(1:3:end-2,1), ...
               data7(1:3:end-2,12)-data7(1:3:end-2,1), ...
               data8(1:3:end-2,12)-data8(1:3:end-2,1), ...
               data9(1:3:end-2,12)-data9(1:3:end-2,1), ...
               data10(1:3:end-2,12)-data10(1:3:end-2,1), ...
               data11(1:3:end-2,12)-data11(1:3:end-2,1), ...
               data12(1:3:end-2,12)-data12(1:3:end-2,1)].*1000;

trans_y_err = [data1(2:3:end-1,12)-data1(2:3:end-1,1), ...
               data2(2:3:end-1,12)-data2(2:3:end-1,1), ...
               data3(2:3:end-1,12)-data3(2:3:end-1,1), ...
               data4(2:3:end-1,12)-data4(2:3:end-1,1), ...
               data5(2:3:end-1,12)-data5(2:3:end-1,1), ...
               data6(2:3:end-1,12)-data6(2:3:end-1,1), ...
               data7(2:3:end-1,12)-data7(2:3:end-1,1), ...
               data8(2:3:end-1,12)-data8(2:3:end-1,1), ...
               data9(2:3:end-1,12)-data9(2:3:end-1,1), ...
               data10(2:3:end-1,12)-data10(2:3:end-1,1), ...
               data11(2:3:end-1,12)-data11(2:3:end-1,1), ...
               data12(2:3:end-1,12)-data12(2:3:end-1,1)].*1000;

trans_z_err = [data1(3:3:end,12)-data1(3:3:end,1), ...
               data2(3:3:end,12)-data2(3:3:end,1), ...
               data3(3:3:end,12)-data3(3:3:end,1), ...
               data4(3:3:end,12)-data4(3:3:end,1), ...
               data5(3:3:end,12)-data5(3:3:end,1), ...
               data6(3:3:end,12)-data6(3:3:end,1), ...
               data7(3:3:end,12)-data7(3:3:end,1), ...
               data8(3:3:end,12)-data8(3:3:end,1), ...
               data9(3:3:end,12)-data9(3:3:end,1), ...
               data10(3:3:end,12)-data10(3:3:end,1), ...
               data11(3:3:end,12)-data11(3:3:end,1), ...
               data12(3:3:end,12)-data12(3:3:end,1)].*1000;
           
  
subplot(2,2,3)
bar(1:12, mean(trans_errs));
xlabel('region ID')
ylabel({'mean translation error','[mm]'})
hold on
errorbar(1:1:12, mean(trans_errs), std(trans_errs))
set(gca, 'YGrid', 'on', 'XGrid', 'off')     

subplot(2,2,4)
decomposed_trans_err = ...
    [mean(trans_x_err);mean(trans_y_err);mean(trans_z_err)];
bar(1:12, decomposed_trans_err,'stacked');
xlabel('region ID')
ylabel({'decomposed translation error','[mm]'})
ylim([min(min(decomposed_trans_err))-5,max(max(decomposed_trans_err))+5])
legend('x direction','y direction','z direction')
set(gca, 'YGrid', 'on', 'XGrid', 'off')

set(gcf, 'Position',  [500, 300, 650, 500])